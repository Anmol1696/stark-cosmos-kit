{"version":3,"sources":["../../src/extension/main-wallet.ts","../../src/extension/client.ts","../../src/extension/utils.ts","../../src/extension/chain-wallet.ts"],"sourcesContent":["import { EndpointOptions, Wallet } from '@cosmos-kit/core';\nimport { MainWalletBase } from '@cosmos-kit/core';\n\nimport { Coin98Client } from './client';\nimport { getCoin98FromExtension } from './utils';\nimport { ChainCoin98Extension } from './chain-wallet';\n\nexport class Coin98ExtensionWallet extends MainWalletBase {\n  constructor(\n    walletInfo: Wallet,\n    preferredEndpoints?: EndpointOptions['endpoints']\n  ) {\n    super(walletInfo, ChainCoin98Extension);\n    this.preferredEndpoints = preferredEndpoints;\n  }\n\n  async initClient() {\n    this.initingClient();\n    try {\n      const coin98 = await getCoin98FromExtension();\n      this.initClientDone(coin98 ? new Coin98Client(coin98) : undefined);\n    } catch (error) {\n      this.logger?.error(error);\n      this.initClientError(error);\n    }\n  }\n}\n","import { chainRegistryChainToKeplr } from '@chain-registry/keplr';\nimport { StdSignDoc, StdSignature } from '@cosmjs/amino';\nimport { Algo, OfflineDirectSigner } from '@cosmjs/proto-signing';\nimport {\n  BroadcastMode,\n  ChainRecord,\n  DirectSignDoc,\n  ExtendedHttpEndpoint,\n  SignOptions,\n  SignType,\n  WalletClient,\n} from '@cosmos-kit/core';\nimport { Coin98 } from './types';\n\nexport class Coin98Client implements WalletClient {\n  readonly client: Coin98;\n\n  constructor(client: Coin98) {\n    this.client = client;\n  }\n\n  async enable(chainIds: string | string[]) {\n    await this.client.enable(chainIds);\n  }\n\n  async connect(chainIds: string | string[]) {\n    await this.client.enable(chainIds)\n  }\n\n  async getSimpleAccount(chainId: string) {\n    await this.enable(chainId)\n    const { address, username } = await this.getAccount(chainId);\n    return {\n      namespace: 'cosmos',\n      chainId,\n      address,\n      username,\n    };\n  }\n\n  async getAccount(chainId: string) {\n    await this.enable(chainId)\n    const key = await this.client.getKey(chainId);\n    return {\n      username: key.name,\n      address: key.bech32Address,\n      algo: key.algo as Algo,\n      pubkey: key.pubKey,\n    };\n  }\n\n  getOfflineSigner(chainId: string, preferredSignType?: SignType) {\n    switch (preferredSignType) {\n      case 'amino':\n        return this.getOfflineSignerAmino(chainId);\n      case 'direct':\n        return this.getOfflineSignerDirect(chainId);\n      default:\n        return this.getOfflineSignerAmino(chainId);\n    }\n    // return this.client.getOfflineSignerAuto(chainId);\n  }\n\n  getOfflineSignerAmino(chainId: string) {\n    return this.client.getOfflineSignerOnlyAmino(chainId);\n  }\n\n  getOfflineSignerDirect(chainId: string) {\n    return this.client.getOfflineSigner(chainId) as OfflineDirectSigner;\n  }\n\n  async addChain(chainInfo: ChainRecord) {\n    const suggestChain = chainRegistryChainToKeplr(\n      chainInfo.chain,\n      chainInfo.assetList ? [chainInfo.assetList] : []\n    );\n\n    if (chainInfo.preferredEndpoints?.rest?.[0]) {\n      (suggestChain.rest as\n        | string\n        | ExtendedHttpEndpoint) = chainInfo.preferredEndpoints?.rest?.[0];\n    }\n\n    if (chainInfo.preferredEndpoints?.rpc?.[0]) {\n      (suggestChain.rpc as\n        | string\n        | ExtendedHttpEndpoint) = chainInfo.preferredEndpoints?.rpc?.[0];\n    }\n\n    await this.client.experimentalSuggestChain(suggestChain);\n  }\n\n  async signAmino(\n    chainId: string,\n    signer: string,\n    signDoc: StdSignDoc,\n    signOptions?: SignOptions\n  ) {\n    return await this.client.signAmino(chainId, signer, signDoc, signOptions);\n  }\n\n  async signDirect(\n    chainId: string,\n    signer: string,\n    signDoc: DirectSignDoc,\n    signOptions?: SignOptions\n  ) {\n    return await this.client.signDirect(chainId, signer, signDoc, signOptions);\n  }\n\n  async signArbitrary(\n    chainId: string,\n    signer: string,\n    data: string | Uint8Array\n  ): Promise<StdSignature> {\n    return await this.client.signArbitrary(chainId, signer, data);\n  }\n\n  async sendTx(chainId: string, tx: Uint8Array, mode: BroadcastMode) {\n    return await this.client.sendTx(chainId, tx, mode);\n  }\n}\n","import { ClientNotExistError } from '@cosmos-kit/core';\nimport { Coin98 } from './types';\n// import { Keplr, Window as KeplrWindow } from '@keplr-wallet/types';\n\ninterface Coin98Window {\n  coin98?: {\n    keplr: Coin98\n  }\n}\n\nexport const getCoin98FromExtension: () => Promise<\n  Coin98 | undefined\n> = async () => {\n  if (typeof window === 'undefined') {\n    return void 0;\n  }\n\n  const provider = (window as Coin98Window).coin98?.keplr;\n\n  if (provider) {\n    return provider;\n  }\n\n  if (document.readyState === 'complete') {\n    if (provider) {\n      return provider;\n    } else {\n      throw ClientNotExistError;\n    }\n  }\n\n  return new Promise((resolve, reject) => {\n    const documentStateChange = (event: Event) => {\n      if (\n        event.target &&\n        (event.target as Document).readyState === 'complete'\n      ) {\n        if (provider) {\n          resolve(provider);\n        } else {\n          reject(ClientNotExistError.message);\n        }\n        document.removeEventListener('readystatechange', documentStateChange);\n      }\n    };\n\n    document.addEventListener('readystatechange', documentStateChange);\n  });\n};\n","import { ChainRecord, ChainWalletBase, Wallet } from '@cosmos-kit/core';\n\nexport class ChainCoin98Extension extends ChainWalletBase {\n  constructor(walletInfo: Wallet, chainInfo: ChainRecord) {\n    super(walletInfo, chainInfo);\n  }\n}\n"],"mappings":"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","names":[]}